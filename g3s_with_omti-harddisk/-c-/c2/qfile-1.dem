(****************************************************************************)
(* Testprogramm fuer QFILE.INC                                              *)
(* Auswahl einer Datei und Ausgabe auf dem Bildschirm                       *)
(****************************************************************************)

(*$I c5:READCHAR.INC *) {Tastaturanpassung, siehe Turbo-Heft 3              }
(*$I c5:WINDOW.PAR   *) {Spezielle Anpassung der Windows an Rechner         }
(*$I c5:WINDOW7.BIB  *) {Fenster auf jedem Rechner, siehe Turbo-Heft 3      }
(*$I c5:SELECT-2.BIB *) {Vert. Menueauswahl aus bis zu 256 Punkten, Turbo 6 }
(*$I c5:QSORT.BIB    *) {Quicksort fuer Felder, siehe Turbo-Heft 4          }
(*$I c5:CPM-80.BIB   *) {Betriebssystemspez. Funktionen, siehe Turbo-Heft 2 }
(*$I c5:QFILE.INC    *) {Auswahl aus einem Directory, siehe Turbo-Heft 6    }
(*$I c5:GETFIRST.INC *) {holt das erste Element aus einer Menge von Bytes   }

var f : text; TextZeile : string[77];  Zg, ZNr  : byte; Dummy: char;
    D1 : Directory; WildC : DateiString; BezugsLaufwerk: string[2];
begin
  ClrScr; InitWindows; ZNr:=0;
  if ParamCount>0 then WildC:=ParamStr(1) else WildC:='*.*';
  openwindow(23,1,57,7); OpenWindow(1,8,80,24); changewindow(1);
  writeln('Dieses Demoprogramm bringt eine');
  writeln('Textdatei auf den Bildschirm.'); writeln;
  write('Bitte waehlen Sie!');
  openwindow(32,6,48,14);
  DirectoryLesen(WildC,D1);
  QueryFile(7,true,true,D1);
  CloseWindow;
  ChangeWindow(2);
  with D1 do
    begin
      if Flags=[]
      then writeln('Keine Datei vorhanden oder ausgewaehlt!')
      else begin
             GetFirst(Flags,Zg);
             if Drive=0 then BezugsLaufwerk:=''
                        else BezugsLaufwerk:=chr(Drive+64)+':';
             {folgende Anweisung ist nur bei CPM-Version noetig: }
             if pos(' ',Name[Zg])<>0
               then delete(Name[Zg],pos(' ',Name[Zg]),9-pos(' ',Name[Zg]));
             assign(f,BezugsLaufwerk+Name[Zg]); reset(f);
             while not eof(f) do begin
               ZNr:=succ(ZNr); readln(f,TextZeile); writeln(TextZeile);
               if ZNr mod 14 = 0
               then begin
                      ChangeWindow(1); gotoxy(1,4);
                      write('Weiter - Taste druecken');
                      read(kbd,Dummy); DelLine; ChangeWindow(2)
                    end;
             end (* while *)
           end; (* else *)
    end; (* with *)
  ExitWindows; Gotoxy(1,24);
end. (* QFILE-1.DEM *)

