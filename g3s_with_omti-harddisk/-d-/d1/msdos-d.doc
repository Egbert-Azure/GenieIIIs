                   MS-DOS Disk-Emulator f}r CP/M-3
                   ===============================
                             Version 2.0

                      Tilmann Reh, 14. Juli 1993


Der MS-DOS Disk Emulator V2.0 ist eine Weiterentwicklung der  fr}heren 
Version 1.2 von 1987 (bekannt durch die Ver|ffentlichung in c't).  Die 
neue  Version ben|tigt keine Anpassung der verschiedenen  Puffergr|~en 
an die verwendeten DOS-Diskettenformate oder TPA-Gr|~en, sondern  pa~t 
sich selbst{ndig dynamisch an. Mit Version 2.0 k|nnen nun auch Dateien 
in  Unterverzeichnissen  bearbeitet werden. Dar}berhinaus  wurden  die 
Funktionen des Emulators erheblich leistungsf{higer, und die  M|glich-
keiten von CP/M-3 werden nun intensiv genutzt.


                        Systemvoraussetzungen
                        ---------------------

Um  den  DOS-Emulator V2.0 auf einem CP/M-3 System zu  verwenden,  mu~ 
letzteres die zu bearbeitenden DOS-Diskettenformate physikalisch lesen 
und schreiben k|nnen. Der Zugriff auf die zweite Seite einer  Diskette 
mu~ durch Sektor- oder Halbspur}berlauf erfolgen, d.h. die Spuren  ei-
nes Zylinders m}ssen nacheinander bearbeitet werden, bevor der n{chste 
Zylinder  angesprochen wird. Anpassungen an die jeweilige  Implementa-
tion sind nicht erforderlich.

Das ]bernehmen der Zeiteintr{ge von Dateien beim Kopieren von DOS nach 
CP/M kann nur dann fehlerfrei erfolgen, wenn die CP/M-Systemuhr  nicht 
interruptgesteuert arbeitet (dies trifft auf die meisten CP/M-3-Syste-
me zu).

Das  Programm wurde mit Hilfe von Turbo-Pascal 3.0 erstellt. Die  End-
Adresse  wurde  beim Kompilieren auf (hex)  D000  eingestellt.  Daraus 
ergibt sich eine minimale TPA-Gr|~e von 52k zum Betrieb von MSDOS.


                        Starten des Emulators
                        ---------------------

Der  Emulator wird aufgerufen, indem der Programmname  MSDOS,  gefolgt 
von  einem  oder  zwei Parametern, eingegeben wird.  Bei  Aufruf  ohne 
Parameter  wird eine kurze Meldung ausgegeben, die den Aufruf und  die 
ben|tigten Parameter erl{utert.

Die Parameter bestehen jeweils aus einem einzelnen Buchstaben, der ein 
Laufwerk des CP/M-Systems repr{sentiert. Der erste Parameter (Buchsta-
be) gibt das Laufwerk an, in dem die MS-DOS-Diskette bearbeitet werden 
soll. Der zweite Parameter ist optional und bezeichnet das  CP/M-Lauf-
werk f}r den Dateientransfer. Wird nur ein Parameter angegeben, werden 
Dateien von bzw. zum Default-Laufwerk kopiert.

Das  Programm erlaubt die Definition zul{ssiger Laufwerke f}r DOS  und 
CP/M. Als Default sind sowohl f}r DOS als auch f}r CP/M alle Laufwerke 
(A: bis P:) zul{ssig. An der Adresse 2163h befinden sich zwei  16-Bit-
Felder, in denen diese Information wie folgt gespeichert ist:
     2163      Bit 0..7       DOS-Laufwerke 'A'..'H'
     2164      Bit 0..7       DOS-Laufwerke 'I'..'P'
     2165      Bit 0..7       CP/M-Laufwerke 'A'..'H'
     2166      Bit 0..7       CP/M-Laufwerke 'I'..'P'
Ein  gesetztes Bit bedeutet dabei grunds{tzlich die  Zul{ssigkeit  des 
entsprechenden Laufwerks (Default: alle Bits gesetzt).

Beim  Aufruf des Emulators wird automatisch die Diskette im  DOS-Lauf-
werk  eingeloggt  (d.h. Parameterblock und FAT's werden  gelesen).  Zu 
diesem  Zeitpunkt mu~ sich also bereits eine g}ltige  DOS-Diskette  in 
diesem  Laufwerk befinden. Diese Diskette kann dann sofort (d.h.  ohne 
explizites Einloggen) bearbeitet werden.


                       Bedienung von MSDOS V2.0
                       ------------------------

Der  MS-DOS  Disk Emulator V2.0 stellt eine eigene  Kommandozeile  zur 
Verf}gung. Der Benutzer gibt, wie von CP/M oder MS-DOS gewohnt, hinter 
einem  Prompt  kurze  Kommandos, teilweise mit  Parametern,  ein.  Die 
Syntax der Kommandos wurde dabei an diesen beiden g{ngigen Oberfl{chen 
orientiert.

Als Prompt (Eingabeaufforderung) wird das Wort "DOS", gefolgt von  dem 
Laufwerksbezeichner des DOS-Laufwerks und dem aktuellen Pfad, ausgege-
ben (z.B. "DOS C:/TEST>"). Dadurch wird gleichzeitig auf die  laufende 
Emulatorsoftware und das Laufwerk mit der (systemfremden) DOS-Diskette 
aufmerksam  gemacht. Die Hierarchieebenen des Pfades werden durch  '/' 
getrennt  ausgegeben (wie unter Unix, siehe obiges Beispiel).  Dadurch 
werden auch Probleme mit der unterschiedlichen Handhabung von Umlauten 
vermieden.

Die  Kommandos werden als kurze Worte oder Abk}rzungen eingegeben  und 
d}rfen  beliebig  Gro~- und Kleinschreibung  enthalten.  Kommando  und 
Parameter  m}ssen jeweils durch Leerzeichen voneinander getrennt  sein 
und Namen m}ssen der }blichen Konvention FILENAME.TYP entsprechen. Bei 
manchen  Kommandos  ist die Verwendung  von  Platzhaltern  (Wildcards) 
zul{ssig; in diesen F{llen sind sowohl '?' als auch '*' erlaubt.

Namen  von Dateien und Verzeichnissen d}rfen nur alphanumerische  Zei-
chen (Buchstaben und Ziffern) enthalten. Die Verwendung von Sonderzei-
chen (oder Umlauten) kann zu unverhersehbaren Problemen f}hren!

Folgende Befehle sind zul{ssig:

CD        Wechseln in ein Unterverzeichnis der DOS-Diskette. Der Para-
          meter  enth{lt  den Namen des  Unterverzeichnisses,  in  das 
          gewechselt werden soll. Als Sonderf{lle werden '..' (voriges 
          Verzeichnis) und '/' (Hauptverzeichnis) behandelt. Die  Ein-
          gabe eines aus mehreren Ebenen bestehenden Pfades ist  nicht 
          m|glich.

D,DIR     Directory der Diskette im DOS-Laufwerk anzeigen. Die Anzeige 
          erfolgt  im DOS-}blichen Format, einspaltig und  mit  Angabe 
          von Dateigr|~e und Zeitangaben. Optional kann ein  Dateiname 
          als Parameter angegeben werden (Wildcards zul{ssig), um  nur 
          bestimmte  Dateien anzuzeigen. Am Ende der Liste  wird  noch 
          die  Gesamtzahl der gefundenen Dateien und die  verbleibende 
          Kapazit{t  der Diskette angezeigt. Falls der  Page-Mode  des 
          CP/M-Systems  aktiv ist, wird die Anzeige jeweils  nach  der 
          Ausgabe eines Schirmes gestoppt und erst nach einem  Tasten-
          druck  fortgesetzt.  Die Gr|~e des  Bildschirmes  wird  beim 
          System erfragt (aus dem System Control Block, SCB). Die Aus-
          gabe kann jederzeit durch Dr}cken von ^C abgebrochen werden.

DW        Directory der DOS-Diskette im CP/M-}blichen Format anzeigen: 
          mehrspaltig,  nur  die Dateinamen. Die  Anzahl  der  Spalten 
          richtet sich nach der im SCB deklarierten Schirmbreite  (bei 
          80  Zeichen  ergeben sich 5 Spalten). Ansonsten wie  D  bzw. 
          DIR.

DEL,ERA   L|schen  von  DOS-Dateien. Als Parameter mu~  ein  Dateiname 
          angegeben werden. Enth{lt der Parameter Wildcards, wird  vor 
          dem L|schvorgang eine Best{tigung verlangt.

H,HELP    Kurze  Kommando-]bersichtsliste anzeigen. Auch das  Kommando 
          '?' hat diese Wirkung.

LOG,NEW   Neue  DOS-Diskette einloggen. Dies ist immer dann  erforder-
          lich, wenn w{hrend einer MSDOS-Sitzung die DOS-Diskette ent-
          nommen  und eine andere zum Bearbeiten eingelegt wird  (auch 
          dann,  wenn diese das gleiche Format wie die vorige  hat!!). 
          Nach  dem Einloggen einer Diskette befindet man sich  grund-
          s{tzlich im Hauptverzeichnis.

P         Druckerprotokoll  an- bzw. abschalten. MSDOS kann  s{mtliche 
          Konsolenausgaben  auf einem Drucker protokollieren (z.B.  um 
          eine  DOS-Directory auf Papier auszudrucken). Dieses  Proto-
          koll ist beim Programmstart abgeschaltet und kann durch  die 
          Eingabe  des Kommandos 'P' eingeschaltet werden.  Nochmalige 
          Eingabe  von  'P' schaltet das Protokoll wieder  aus  (wobei 
          dieses 'P' noch mit protokolliert wird).

Q,QUIT    MS-DOS  Disk Emulator beenden und zu CP/M zur}ckkehren.  Die 
          DOS-Diskette sollte aus ihrem Laufwerk entnommen werden,  da 
          ein  direkter Zugriff von CP/M aufgrund des  v|llig  anderen 
          Dateisystems zwangsweise zu Fehlern f}hrt.

REN       DOS-Datei  umbenennen.  Es werden zwei  Parameter  erwartet, 
          wobei der erste Parameter den alten und der zweite den neuen 
          Dateinamen enth{lt. Evtl. fehlende Parameter werden explizit 
          erfragt,  so da~ der Befehl auch ganz ohne Parameter  ausge-
          f}hrt werden kann. Wildcards sind nicht zul{ssig.

RD        Datei(en) von DOS nach CP/M kopieren (lesen). Es k|nnen zwei 
          Parameter  angegeben werden, von denen der erste den  Datei-
          namen  unter  DOS und der zweite den Dateinamen  unter  CP/M 
          enth{lt.  Dateien k|nnen also w{hrend der ]bertragung  umbe-
          nannt  werden. Wird nur ein Dateiname angegeben, erh{lt  die 
          Kopie  automatisch  denselben Namen wie das  Original.  Wird 
          kein  Parameter angegeben, werden beide Dateinamen  explizit 
          erfragt.  Falls beim ersten Dateinamen  Wildcards  verwendet 
          werden, erhalten die Kopien grunds{tzlichen denselben  Namen 
          wie  die  Originale;  evtl.  eingegebene  abweichende  Namen 
          werden ignoriert.
          Beim  Kopieren von Dateien erh{lt die Kopie dieselben  Zeit-
          eintr{ge  wie das Original, ebenso wird der  Byte-Count  der 
          Kopie entsprechend der Dateil{nge des Originals gesetzt.

TYP,TYPE  Ausgabe einer Datei von der DOS-Diskette auf dem Bildschirm. 
          Zeilen,  die  l{nger sind als die  Bildschirmbreite,  werden 
          entsprechend  abgeschnitten. Nach jeder  ausgegebenen  Seite 
          wird die Ausgabe angehalten (nur im Page-Mode), die  Ausgabe 
          kann jederzeit durch ^C abgebrochen werden. Es erfolgt  kei-
          nerlei Zeichensatz-Konvertierung oder Filterung von  Steuer-
          zeichen (au~er CR, LF und ^Z)!

WR        Datei(en) von CP/M nach DOS kopieren (schreiben). Au~er  der 
          Transferrichtung gilt die Beschreibung des Kommandos 'RD'.

XD        Wie  D, allerdings wird das Directory des angegebenen  CP/M-
          Laufwerks angezeigt.

XDW       Ausgabe des CP/M-Directories im CP/M-Format.


                              Copyright
                              ---------

Das  Programm ist (C) Copyright 1993 von Tilmann Reh. Es ist frei  ko-
pierbar unter der Bedingung, da~ ALLE zugeh|rigen Dateien (einschlie~-
lich dieses Dokument) und diese V\LLIG UNVER[NDERT weitergegeben  wer-
den. Eine kommerzielle Nutzung des Programms oder die Weitergabe gegen 
Entgelt  (auch  Kopiergeb}hren)  ist nur  nach  meiner  ausdr}cklichen 
schriftlichen Genehmigung zul{ssig. Wem das Programm gef{llt (bzw. wer 
es  benutzt), wird nicht davon abgehalten, 20 DM (anonym) an  mich  zu 
senden,  um  die vielen Stunden des Programmierens zu  honorieren  und 
mich auch zu weiterer Programmentwicklung anzuspornen (sog. User  Sup-
ported Software).

An dieser Stelle m|chte ich mich auch ausdr}cklich bei Helmut Jungkunz 
(Ismaning) f}r die vielen Anregungen und Beta-Tests bedanken.

CP/M ist ein Warenzeichen von Digital Research.
MS-DOS ist ein Warenzeichen von Microsoft.
Turbo Pascal ist ein Warenzeichen von Borland.


Fehler-Reports und/oder Verbesserungsvorschl{ge bitte an:

     Tilmann Reh, In der Gro~enbach 46, D-57072 Siegen, Deutschland
     Telefon +49 271 312599, Telefax +49 271 317359
     eMail: tilmann.reh@hrz.uni-siegen.d400.de

Die Postanschrift d}rfte die sicherste sein, die anderen Angaben  k|n-
nen sich durchaus mal {ndern...

Viel Spa~ und Erfolg mit dem Programm!
