1
PSTR:	MOV	A,D! ORA A! JNZ PLOOP! MOV A,E! ORA A! RZ
PLOOP:	PUSH	D! PUSH B! MOV E,M! PUSH H! PUSH PSW
	CALL	0005H
	POP	PSW! POP H! POP B! POP D! INX H! DCX D! MOV A,E! ORA A
	JNZ	PLOOP
	MOV	A,D! ORA A! JNZ PLOOP
	RET
PLNE:	PUSH	B! MVI E,13
	CALL	0005! POP B! PUSH B! MVI E,10
	CALL	0005! POP B! RET
2
PNUM:	LXI	D,SAREA! PUSH B! MOV A,H! ANI 080H! JZ PNUM2
	MOV	A,H! CMA! MOV H,A! MOV A,L! CMA! MOV L,A! INX H
	MVI	A,'-'! STAX D! JMP PNUM3
PNUM2:	MVI	A,'+'! STAX D
PNUM3:	INX	D
	LXI	B,-10000! CALL DECDIG
	LXI	B,-1000! CALL DECDIG
	LXI	B,-100! CALL DECDIG
	LXI	B,-10! CALL DECDIG
	MOV	A,L! ORI '0'! STAX D
	LXI	D,0006H! LXI H,SAREA
	POP	B! JMP PSTR
3
DECDIG:	MVI	A,'0'-1
DECLP:	INR	A! DAD B! JC DECLP
	STAX	D! INX D! MOV A,B! CMA
	MOV	B,A! MOV A,C! CMA
	MOV	C,A! INX B! DAD B! RET
4
5
ARITH:	DAD	D! RET
6
ARITH2:	MOV	A,H! CMA! MOV H,A
	MOV	A,L! CMA! MOV L,A! INX H! DAD D! RET
7
ARITH3:	LXI	B,0000H
	MOV	C,L
	CALL	MULT
	PUSH	B! LXI B,0000H
	MOV	C,H! MOV D,E
	CALL	MULT! PUSH B! LXI B,0000H
	MOV	C,L! CALL MULT
	POP	H! MOV H,L! MVI L,00H! DAD B
	POP	D! MOV D,E! MVI E,00H! DAD D
	RET
MULT:	PUSH	D! MVI E,09
MULT0:	MOV	A,C! RAR! MOV C,A! DCR E! JZ MULT2
	MOV	A,B! JNC MULT1
	ADD	D
MULT1:	RAR! MOV B,A! JMP MULT0
MULT2:	POP	D! RET
8
ARITH4:	MOV	A,H! ANI 080H! MOV B,A! MOV A,D! ANI 080H
	CMP	B! JZ DS0!
	MVI	B,080H
	RAL! JNC DSA
	DCX	D! MOV A,D! CMA! MOV D,A! MOV A,E! CMA! MOV E,A
	JMP	DS2
DSA:	DCX	H! MOV A,H! CMA! MOV H,A! MOV A,L! CMA! MOV L,A
	JMP	DS2
DS0:	ORA	A! JZ DSTART
	DCX	D! MOV A,D! CMA! MOV D,A! MOV A,E! CMA! MOV E,A
	DCX	H! MOV A,H! CMA! MOV H,A! MOV A,L! CMA! MOV L,A
DSTART:	LXI	B,0
DS2:	PUSH	B! LXI B,0
	MOV	B,D! MOV C,E! XCHG
	MOV	A,D! CMA! MOV D,A! MOV A,E! CMA! MOV E,A! INX D
	LXI	H,0! MVI A,17
DV0:	PUSH	H! DAD D! JNC DV1! XTHL
DV1:	POP	H! PUSH PSW! MOV A,C! RAL! MOV C,A
	MOV	A,B! RAL! MOV B,A! MOV A,L! RAL! MOV L,A
	MOV	A,H! RAL! MOV H,A! POP PSW! DCR A! JNZ DV0
	ORA	A! MOV A,H! RAR! MOV D,A! MOV A,L! RAR! MOV E,A
	POP	H! MOV A,H! ORA A! JNZ DV2
	LXI	H,0
	DAD	B
	RET
DV2:	MOV	A,B! CMA! MOV H,A! MOV A,C! CMA! MOV L,A! INX H! RET
9
ARITH5:	MOV	A,H! ANA D! MOV H,A! MOV A,L! ANA E! MOV L,A
	RET
10
ARITH6:	MOV	A,H! ORA D! MOV H,A! MOV A,L! ORA E! MOV L,A
	RET
11
ARITH7:	MOV	A,H! CMA! MOV H,A! MOV A,L! CMA! MOV L,A
	RET
12
ARITH8:	MOV	A,H! XRA D! MOV H,A! MOV A,L! XRA E! MOV L,A
	RET
13
ARITH9:	CALL	ARITH4! XCHG! RET
14
GETNUM:	LXI	D,SAREA! LXI H,0000H! LXI B,0
IPLP:	PUSH	B! MVI C,01H! PUSH D! PUSH H! CALL 0005H
	POP	H! POP D! POP B! STAX D! INX D! INX H! INX B
	CPI	13! JZ IPDONE! CPI 10! JZ IPDONE! CPI 3! JZ 0000H
	CPI	8! CZ IPBS
	JMP	IPLP
IPBS:	DCX	B! DCX B! MOV A,B! RAL! JC IPBS2
	DCX	H! DCX H! DCX D! DCX D! PUSH D! PUSH H! PUSH B! MVI C,2
	MVI	E,32! CALL 0005H! MVI C,2! MVI E,8! CALL 0005H
	POP	B! POP H! POP D! RET
IPBS2:	INX	B! DCX H! DCX D! PUSH B! PUSH D! PUSH H! MVI C,2! MVI E,32
	CALL	0005H! POP H! POP D! POP B! RET
IPDONE:	LXI	D,SAREA! LXI H,0000H! PUSH H!
IP2:	LDAX	D! INX D! CPI '-'! JZ IP3
	CPI	'0'! JC IPST! CPI '9'+1! JNC IP2
	SUI	'0'! MOV B,H! MOV C,L! DAD H! DAD H! DAD B
	DAD	H! ADD L! MOV L,A! JMP IP2
IP3:	POP	B! INX B! PUSH B! JMP IP2
IPST:	POP	B! MOV A,C! ORA A! JZ IPST2
	MOV	A,H! CMA! MOV H,A! MOV A,L! CMA! MOV L,A
	INX	H
IPST2:	PUSH	H! MVI E,10! MVI C,2! CALL 0005H
	MVI	E,13! MVI C,2! CALL 0005H! POP H! RET
15
GETSTR:	LXI	H,0! LXI B,0
STRLP:	PUSH	B! MVI C,01H! PUSH D! PUSH H! CALL 0005H
	POP	H! POP D! POP B! CPI 13! JZ SQUIT! CPI 3! JZ 0000H
	STAX	D! INX D! INX H! INX B! CPI 8! CZ SBS! JMP STRLP
SQUIT:	MVI	E,10! MVI C,2! PUSH H
	CALL	0005H! POP H! RET
SBS:	DCX	B! DCX B! MOV A,B! RAL! JC SBS2
	DCX	D! DCX D! DCX H! DCX H! PUSH B! PUSH D! PUSH H! MVI C,2!
	MVI	E,32! CALL 0005H! MVI C,2! MVI E,8! CALL 0005H
	POP	H! POP D! POP B! RET
SBS2:	INX	B! DCX D! DCX H! PUSH B! PUSH D! PUSH H! MVI C,2! MVI E,32
	CALL	0005H! POP H! POP D! POP B! RET
16
SC:	PUSH	D! PUSH H! INX H! INX H! INX D! INX D
	LDAX	D! MOV C,M! CMP C! JNZ SNE
	INX	H! INX D! LDAX D! MOV B,M! CMP B! JNZ SNE
	POP	H! POP D! PUSH B! MOV C,M! INX H! MOV B,M
	LXI	H,0! DAD B! PUSH H! LDAX D! MOV L,A! INX D
	LDAX	D! MOV H,A! XCHG! POP H! POP B
SC2:	MOV	A,B! ORA A! JNZ SC3
	MOV	A,C! ORA A! JZ SEQ
SC3:	PUSH	B! MOV B,M! LDAX D! CMP B! JNZ SNE2
	POP	B! DCX B! INX H! INX D! JMP SC2
SEQ:	MVI	A,0FFH! RET
SNE:	POP	B
SNE2:	POP	B! MVI A,0! RET
17
SC4:	CALL	SC! CMA! RET
18
SC5:	PUSH	D! PUSH H! INX H! INX H! INX D! INX D
	LDAX	D! MOV C,A! INX D! LDAX D! MOV B,A! PUSH B
	MOV	C,M! INX H! MOV B,M! LXI H,0! DAD B
	SHLD	SAREA+2! POP H! SHLD SAREA
	POP	H! POP D! MOV C,M! INX H! MOV B,M
	LXI	H,0! DAD B! PUSH H! LDAX D! MOV L,A! INX D
	LDAX	D! MOV H,A! XCHG! POP H
SC6:	PUSH	D! PUSH H! LHLD SAREA! XCHG! LHLD SAREA+2
	MOV	A,H! CMP L! JNZ SC6A
	ORA	A! JZ SLTF
SC6A:	MOV	A,D! CMP E! JNZ SC7
	ORA	A! JZ SLTT
SC7:	POP	H! POP D! LDAX D! MOV B,M
	INX	H! INX D! PUSH H
	LHLD	SAREA+2! DCX H! SHLD SAREA+2! LHLD SAREA
	DCX	H! SHLD SAREA! POP H
	CMP	B! JC SLTT2! JNZ SLTF2
	JMP	SC6
SLTT:	POP	B! POP B
SLTT2:	MVI	A,0FFH! RET
SLTF:	POP	B! POP B
SLTF2:	MVI	A,0! RET
19
SC8:	CALL	SC5! CMA! RET
20
SC9:	CALL	SC5! ORA A! RNZ! CALL SC! RET
21
SCA:	CALL	SC9! CMA! RET
22
NC:	MOV	A,H! CMP D! JNZ NNE! MOV A,L! CMP E! JNZ NNE
NEQ:	MVI	A,0FFH! RET
NNE:	MVI	A,00H! RET
23
NC1:	CALL	NC! CMA! RET
24
NC2:	mov a,h! adi 128! mov h,a! mov a,d! adi 128
	cmp h! jc NEQ! jnz NNE
	mov a,e! cmp l! jc NEQ! jmp NNE
25
NC3:	CALL	NC2! CMA! RET
26
NC4:	XCHG! JMP NC2
27
NC5:	CALL	NC4! CMA! RET
28
29
ROPEN:	xchg!	shld SAREA! xchg! shld SAREA+2! push b! mvi b,36! mvi a,0
ROPEN1:	stax d! inx d! dcr b! cmp b! jnz ROPEN1! lhld sarea! xchg! inx d
	mvi	b,11
ROPEN2:	mvi	a,32! stax d! inx d! dcr b! mov a,b! ora a! jnz ROPEN2
	lhld	SAREA! xchg! lhld SAREA+2! pop b
	inx	h! mov a,m! dcx h! cpi ':'! jnz ROPEN3
	mov	a,m! sui 64! stax d! inx h! inx h! dcr b! dcr b
ROPEN3:	inx	d! mov a,b! ora a! jz ROPEN6! mov a,m! cpi '.'! cz ROPEN4
	stax	d! dcr b! inx h! jmp ROPEN3
ROPEN4:	push	h! lhld SAREA! lxi d,9! dad d! xchg! pop h! inx h
	dcr	b! mov a,b! ora a! jz ROPEN5! mov a,m! ret
ROPEN5:	pop	h
ROPEN6:	lhld	SAREA! XCHG
	MVI	C,15! PUSH D! CALL 0005
	POP	D! INR A! ORA A! JZ FCREAT! RET
FCREAT:	MVI	C,22! CALL 0005! INR A! ORA A! RNZ
	MVI	C,9! LXI D,FERR! CALL 0005! JMP 0
FERR:	DB	'FILE CREATION ERROR: NO DIRECTORY SPACE AVAILABLE.',13,10,'$'
RGET:	PUSH	B! PUSH D! PUSH H! MOV H,B! MOV L,C! SHLD SAREA
	POP	H! POP D! POP B! PUSH B! PUSH D! PUSH H
	LXI	H,33! DAD D! XCHG! POP H
	MOV	A,L! STAX D! INX D! MOV A,H! STAX D! INX D
	MVI	A,0! STAX D! POP B! POP D
	PUSH	B! MVI C,26! CALL 0005
	POP	D! MVI C,33! CALL 0005! ORA A! JNZ GETERR
	RET
GETERR:	LHLD	SAREA! MVI B,128
GETER1:	MVI	A,0! MOV M,A! DCR B! MOV A,B! ORA A! RZ! INX H! JMP GETER1
RPUT:	PUSH	B! PUSH D! PUSH H
	LXI	H,33! DAD D! XCHG! POP H
	MOV	A,L! STAX D! INX D! MOV A,H! STAX D! INX D
	MVI	A,0! STAX D! POP B! POP D
	PUSH	B! MVI C,26! CALL 0005
	POP	D! MVI C,34! CALL 0005! RET
FCLOS:	MVI	C,16! CALL 0005! INR A! ORA A! RNZ
	MVI	C,9! LXI D,FCERR! CALL 0005! JMP 0
FCERR:	DB	'FILE CLOSE ERROR REPORTED BY CP/M.',0DH,0AH,'$'
30
31
ASCBIN:	LXI	H,0! PUSH H
ASCB2:	MOV 	A,B! ORA A! JNZ ASCB3
	MOV	A,C! ORA A! JZ ASCB4
ASCB3:	LDAX	D! DCX B! INX D! CPI '-'! CC ASCB5
	CPI	'0'! JC ASCB2
	CPI	'9'+1! JNC ASCB2
	SUI	'0'! PUSH D! PUSH H! POP D! DAD H! DAD H! DAD D! DAD H
	LXI	D,0! MOV E,A! DAD D! POP D! JMP ASCB2
ASCB4:	POP	B! MOV A,B! ORA A! RZ
	MOV	A,H! CMA! MOV H,A! MOV A,L! CMA! MOV L,A! INX H! RET
ASCB5:	POP H!	MVI H,1! PUSH H! RET
32
STR:	PUSH	D! LDAX D! MOV C,A! INX D! LDAX D! MOV D,A! MOV E,C
	MOV	A,H! ANI 080H! JZ STR2
	MOV	A,H! CMA! MOV H,A! MOV A,L! CMA! MOV L,A! INX H
	MVI	A,'-'
	STAX	D
	JMP	STR3
STR2:	MVI	A,'+'
	STAX	D
STR3:	INX	D
	MOV	A,H! ANI 07FH! MOV H,A
	LXI	B,-10000! CALL DECDIG
	LXI	B,-1000! CALL DECDIG
	LXI	B,-100! CALL DECDIG
	LXI	B,-10! CALL DECDIG
	MOV	A,L! ORI '0'! STAX D
	LXI	H,0006H! POP D! INX D! INX D! MOV A,L! STAX D! INX D
	MOV	A,H! STAX D! RET
33
STRMV:	MOV	A,B! ORA A! JNZ STRMV1
	MOV	A,C! ORA A! RZ
STRMV1:	MOV	A,M! STAX D! INX D! INX H! DCX B! JMP STRMV
34
	;EXPANSION AREA

